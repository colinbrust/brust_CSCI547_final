import ee
from utility_functions import align_merge as am


def get_smap_data():
    sm2015 = ee.ImageCollection('users/colinbrust/l4rz_2015')
    sm2016 = ee.ImageCollection('users/colinbrust/l4rz_2016')
    sm2017 = ee.ImageCollection('users/colinbrust/l4rz_2017')
    sm2018 = ee.ImageCollection('users/colinbrust/l4rz_2018')

    return sm2015.merge(sm2016).merge(sm2017).merge(sm2018).select(['surfMean', 'rzMean'])


def add_date_band(img):
    doy = img.date().getRelative('day', 'year')
    doy_band = ee.Image.constant(doy).uint16().rename('doy')

    return img.addBands(doy_band)


def get_gridmet_data(proj):
    gm = ee.ImageCollection('IDAHO_EPSCOR/GRIDMET') \
        .select(['vpd', 'tmmn', 'tmmx', 'rmin', 'rmax']) \
        .filterDate('2015-04-01', '2019-01-01')

    gm = am.apply_match_proj(gm, proj)

    return gm.map(add_date_band)


def get_data():
    smap = get_smap_data()
    proj = smap.first().projection()

    gm = get_gridmet_data(proj=proj)

    dat = am.data_join(smap, gm)
    dat = dat.map(lambda img: img.addBands(ee.Image.pixelLonLat()))

    return dat


def get_roi():
    return ee.Geometry.Polygon(
        [[[-124.08817866437181, 44.20536642973822],
          [-124.28593257062181, 43.37263703838244],
          [-124.52763178937181, 42.87548507984563],
          [-124.41776850812181, 42.746532150867594],
          [-124.38480952374681, 42.42297399778421],
          [-124.23100092999681, 41.967173190905825],
          [-124.03324702374681, 41.56565290078132],
          [-124.08817866437181, 41.269058200401425],
          [-124.41776850812181, 40.49659530228027],
          [-124.32987788312181, 40.253877739546134],
          [-123.85746577374681, 39.81647301636557],
          [-123.79154780499681, 39.655952803337684],
          [-123.78056147687181, 39.240256251949646],
          [-123.75858882062181, 38.95035705721786],
          [-123.00053217999681, 38.298046103260184],
          [-122.91264155499681, 38.02161653603375],
          [-122.53910639874681, 37.78756480619082],
          [-122.44022944562181, 37.4307314394822],
          [-122.40727046124681, 37.21231094136218],
          [-122.22050288312181, 37.01957630143956],
          [-121.80302241437181, 36.86151971146311],
          [-121.84696772687181, 36.64145332885361],
          [-121.95683100812181, 36.5267695488991],
          [-121.85795405499681, 36.28803631619704],
          [-121.48441889874681, 35.89742068598336],
          [-120.89115717999681, 35.263028143713825],
          [-120.71537592999681, 35.02046438981473],
          [-120.61649897687181, 34.59650344384414],
          [-120.34184077374681, 34.46979622946163],
          [-119.49589350812181, 34.370105390150634],
          [-119.17728999249681, 34.0612198451187],
          [-118.46317866437181, 34.00659319937919],
          [-118.39726069562181, 33.787735278775166],
          [-118.00175288312181, 33.69637885655238],
          [-117.35355952374681, 33.155401064619106],
          [-117.17777827374681, 32.555522695885124],
          [-114.78171799290539, 32.74053242113739],
          [-114.83664963353039, 32.52773824528219],
          [-111.11228439915539, 31.324928300329198],
          [-110.74973557103039, 31.334312713441275],
          [-108.20090744603039, 31.334312713441275],
          [-108.20090744603039, 31.755640451792747],
          [-108.05808518040539, 31.774321924927637],
          [-107.11326096165539, 31.783661247020714],
          [-106.43210861790539, 31.746298301057088],
          [-105.95969650853039, 31.334312713441275],
          [-105.23459885228039, 30.8257853651923],
          [-104.82810471165539, 30.39083030735651],
          [-104.63035080540539, 29.81104486317988],
          [-104.17991135228039, 29.429019679723176],
          [-103.42185471165539, 29.035947039580382],
          [-103.09226486790539, 29.055156282473565],
          [-102.81760666478039, 29.55333663923239],
          [-102.37815353978039, 29.84916760505398],
          [-101.40037033665539, 29.85869601746479],
          [-100.91697189915539, 29.390737637770236],
          [-100.3620940107196, 28.434164382261034],
          [-99.6260100263446, 27.67793947014168],
          [-99.2524748700946, 26.877251420776265],
          [-98.9118986982196, 26.38621639105626],
          [-97.9341154950946, 26.051113296975675],
          [-97.3408537763446, 25.991877468158442],
          [-97.4287444013446, 27.375919202492096],
          [-97.2749358075946, 27.969424326088532],
          [-96.6487151044696, 28.327840167372873],
          [-95.6050139325946, 28.85839139370072],
          [-94.54679939283153, 29.55227594673445],
          [-93.22844001783153, 29.781384985683648],
          [-92.20671150220653, 29.895743501284663],
          [-91.58049079908153, 29.70507330522671],
          [-91.15202400220653, 29.49491724405449],
          [-90.43791267408153, 29.447093497632036],
          [-89.82267829908153, 29.590497007393438],
          [-89.72380134595653, 29.848110031871226],
          [-90.03141853345653, 30.009970939246067],
          [-90.48185798658153, 30.076542958315756],
          [-90.39396736158153, 30.39925490877978],
          [-90.03141853345653, 30.351863766978887],
          [-89.63591072095653, 30.2380313716913],
          [-89.27336189283153, 30.32341805751621],
          [-88.19670173658153, 30.28547759268006],
          [-88.11979743970653, 30.70201300947003],
          [-87.88908454908153, 30.67366958217354],
          [-87.87809822095653, 30.512899826247956],
          [-87.70231697095653, 30.27599018257246],
          [-87.10905525220653, 30.40873037951148],
          [-86.83439704908153, 30.44662306467815],
          [-86.20046699219756, 30.351863766978887],
          [-85.69509589844756, 30.219046466384906],
          [-85.34353339844756, 29.838580609140962],
          [-85.06887519532256, 29.714615440659912],
          [-84.60744941407256, 29.905267465084354],
          [-84.28884589844756, 30.076542958315756],
          [-84.01418769532256, 30.076542958315756],
          [-83.67361152344756, 29.895743501284663],
          [-83.37698066407256, 29.49491724405449],
          [-83.06936347657256, 29.21722607253938],
          [-82.80569160157256, 29.121295265456293],
          [-82.64089667969756, 28.82334143729975],
          [-82.71780097657256, 28.408636214227673],
          [-82.82766425782256, 27.846687278247572],
          [-82.61892402344756, 27.515905680734893],
          [-82.35525214844756, 26.95912562984726],
          [-82.10256660157256, 26.743486197856946],
          [-81.86086738282256, 26.429098038695145],
          [-81.71804511719756, 25.886738629882974],
          [-81.46535957032256, 25.866969080543313],
          [-81.32253730469756, 25.63938195723508],
          [-80.95998847657256, 25.17296380800722],
          [-80.45461738282256, 25.292220549607922],
          [-80.35574042969756, 25.550207636968484],
          [-80.16897285157256, 26.015159944722345],
          [-80.13601386719756, 26.880758842035927],
          [-80.41067207032256, 27.57435163714135],
          [-81.16872871094756, 29.523600660252143],
          [-81.45437324219756, 30.427678561986244],
          [-81.36648261719756, 31.238951627685154],
          [-80.59743964844756, 32.331549090858495],
          [-79.94924628907256, 32.70210955632236],
          [-79.36697089844756, 33.19074038639062],
          [-78.88357246094756, 33.74977011974757],
          [-78.02663886719756, 33.95050049216607],
          [-77.08759704547856, 34.69395090006644],
          [-76.42841735797856, 34.83835269998413],
          [-76.10981384235356, 35.4134266707973],
          [-75.81318298297856, 35.868772736462205],
          [-76.77997985797856, 35.904376305341096],
          [-76.65913024860356, 36.08215386209083],
          [-76.07685485797856, 36.20635956270136],
          [-76.07685485797856, 36.74524127289744],
          [-76.51630798297856, 37.03520249603943],
          [-76.40644470172856, 38.166713741377094],
          [-76.57123962360356, 38.67454986727025],
          [-76.57123962360356, 39.2554140375202],
          [-75.84614196735356, 39.611800027034356],
          [-76.13178649860356, 38.957034650602075],
          [-75.91205993610356, 38.43398803608932],
          [-75.74726501422856, 37.98509800844639],
          [-75.38471618610356, 38.02838075141327],
          [-75.12104431110356, 38.382334391911584],
          [-75.23090759235356, 38.76026961805264],
          [-75.57148376422856, 39.34892939893823],
          [-75.48359313922856, 39.46776818628126],
          [-74.95624938922856, 39.195839228579786],
          [-74.70356384235356, 39.144734867309246],
          [-74.42890563922856, 39.374411901491996],
          [-74.22016540485356, 39.6456464241224],
          [-74.06635681110356, 40.000033130189934],
          [-73.96747985797856, 40.377702583775296],
          [-74.27509704547856, 40.43626207105963],
          [-74.11030212360356, 40.569920947699124],
          [-73.60493102985356, 40.57826578329007],
          [-72.58320251422856, 40.82812667975756],
          [-72.68207946735356, 40.96100239066562],
          [-73.14350524860356, 40.93610852510142],
          [-73.57197204547856, 40.90290210646016],
          [-73.76972595172856, 40.91120527505031],
          [-73.46210876422856, 41.11016844533098],
          [-72.55024352985356, 41.24247664106828],
          [-71.46259704547856, 41.415725430747266],
          [-71.48456970172856, 41.67883725658093],
          [-71.26484313922856, 41.72805148883484],
          [-71.24287048297856, 41.60494529000676],
          [-71.13300720172856, 41.49806289077986],
          [-70.97919860797856, 41.51451783868025],
          [-70.86933532672856, 41.62958536002697],
          [-70.68256774860356, 41.70344908121559],
          [-70.61664977985356, 41.53096860452162],
          [-70.30903259235356, 41.596729841459684],
          [-69.96845642047856, 41.65421601586942],
          [-70.00141540485356, 41.79361186335185],
          [-70.30903259235356, 41.744447861778944],
          [-70.44086852985356, 41.752644478507456],
          [-70.53974548297856, 41.89182681457984],
          [-70.60566345172856, 42.00622034702279],
          [-70.70454040485356, 42.169283489956655],
          [-70.85834899860356, 42.28317824177626],
          [-71.00117126422856, 42.34004855286732],
          [-70.93525329547856, 42.4617404471727],
          [-70.60566345172856, 42.56701581021193],
          [-70.61664977985356, 42.69634199720293],
          [-70.80341735797856, 42.67211380715249],
          [-70.88032165485356, 42.89787605706324],
          [-70.69355407672856, 43.09073108692742],
          [-70.36396423297856, 43.402829292242146],
          [-70.26508727985356, 43.657715233765856],
          [-69.96845642047856, 43.87193723645772],
          [-69.07856384235356, 44.10906180459686],
          [-68.86982360797856, 44.509998926216],
          [-68.47431579547856, 44.47081246439374],
          [-68.04584899860356, 44.423753957268886],
          [-67.37568298297856, 44.65085218329331],
          [-67.03510681110356, 44.752367312753854],
          [-66.95820251422856, 44.90819685740764],
          [-67.11201110797856, 45.1876283172483],
          [-67.38666931110356, 45.195370816340066],
          [-67.45258727985356, 45.38859098505712],
          [-67.40864196735356, 45.5888416897709],
          [-67.68330017047856, 45.65031406825483],
          [-67.77119079547856, 45.803700173872116],
          [-67.76020446735356, 46.147279174946036],
          [-67.76020446735356, 46.797969385038485],
          [-67.79316345172856, 47.07552486112242],
          [-68.01289001422856, 47.26970339909746],
          [-68.25458923297856, 47.38140658106894],
          [-68.50727477985356, 47.32186094608453],
          [-68.90278259235356, 47.18017075770141],
          [-69.01264587360356, 47.26970339909746],
          [-69.02363220172856, 47.44088503758517],
          [-69.23237243610356, 47.455744156451296],
          [-70.01240173297856, 46.76787720322304],
          [-70.05634704547856, 46.45089354251388],
          [-70.30903259235356, 46.25373571137926],
          [-70.25410095172856, 45.92610582460673],
          [-70.42988220172856, 45.74239627353252],
          [-70.72651306110356, 45.511906439297626],
          [-71.00117126422856, 45.349999613198065],
          [-71.19892517047856, 45.24180369215591],
          [-71.35273376422856, 45.265005910976534],
          [-71.51752868610356, 45.04808322151443],
          [-72.15473571735356, 45.00149235229136],
          [-73.28632751422856, 44.98595363614382],
          [-74.47285095172856, 45.01702685523497],
          [-74.97822204547856, 44.96263766216649],
          [-75.23090759235356, 44.84591559713007],
          [-75.71430602985356, 44.51783305915973],
          [-76.34052673297856, 44.09328297534537],
          [-76.14277282672856, 43.91943793832867],
          [-76.25263610797856, 43.82439864515242],
          [-76.16474548297856, 43.55429773320391],
          [-76.53828063922856, 43.43474893867695],
          [-76.98872009235356, 43.2589826692013],
          [-77.70283142047856, 43.29897423792858],
          [-78.42792907672856, 43.394846751431615],
          [-79.06513610797856, 43.2589826692013],
          [-79.01020446735356, 43.010448375830286],
          [-78.80146423297856, 42.82539941092897],
          [-79.08710876422856, 42.591284938688005],
          [-79.54853454547856, 42.364405812433],
          [-80.40546813922856, 42.00622034702279],
          [-81.15253845172856, 41.834553080437125],
          [-81.63593688922856, 41.53096860452162],
          [-82.51484313922856, 41.366272789085045],
          [-82.87739196735356, 41.45690722645618],
          [-83.09711852985356, 41.596729841459684],
          [-83.44868102985356, 41.71985173268779],
          [-83.30585876422856, 41.98989098245014],
          [-83.11909118610356, 42.22625655086864],
          [-82.92133727985356, 42.44552849849987],
          [-82.70161071735356, 42.63171249421631],
          [-82.43793884235356, 42.90592376570354],
          [-81.77875915485356, 43.29897423792858],
          [-82.29511657672856, 43.0506028671688],
          [-82.50385681110356, 43.17090870182933],
          [-82.56977477985356, 43.61796031323388],
          [-82.75654235797856, 43.98271326419718],
          [-82.99824157672856, 44.03802391109045],
          [-83.34980407672856, 43.85609524917038],
          [-83.66840759235356, 43.61796031323388],
          [-83.93207946735356, 43.705386417474216],
          [-83.88813415485356, 43.95108402202265],
          [-83.62446227985356, 44.061712683634894],
          [-83.56953063922856, 44.22726878823116],
          [-83.34980407672856, 44.290215646172534],
          [-83.27289977985356, 44.55698792650603],
          [-83.29487243610356, 44.84591559713007],
          [-83.42670837360356, 45.040320709894885],
          [-83.31684509235356, 45.086879980130945],
          [-83.39374938922856, 45.24180369215591],
          [-83.66840759235356, 45.40402016134581],
          [-84.03095642047856, 45.45798910289144],
          [-84.39350524860356, 45.65799337686622],
          [-84.61323181110356, 45.77305664704189],
          [-84.89887634235356, 45.76539313305968],
          [-85.11860290485356, 45.5965294227936],
          [-85.12958923297856, 45.357719994000426],
          [-85.37128845172856, 45.22633027996223],
          [-85.39326110797856, 45.00149235229136],
          [-85.63496032672856, 44.799160413890135],
          [-85.54706970172856, 45.172140159227624],
          [-85.68989196735356, 45.10239131049914],
          [-85.92060485797856, 44.98595363614382],
          [-86.06342712360356, 44.79136419687617],
          [-86.19526306110356, 44.64303595453058],
          [-86.26118102985356, 44.360950308413784],
          [-86.51386657672856, 44.08539198155482],
          [-86.42597595172856, 43.76888907064138],
          [-86.54682556110356, 43.657715233765856],
          [-86.33808532672856, 43.210958092167466],
          [-86.25019470172856, 42.85762175729845],
          [-86.26118102985356, 42.5022519579321],
          [-86.40400329547856, 42.20998377486801],
          [-86.55781188922856, 41.95721968365377],
          [-86.94233337360356, 41.711650930136535],
          [-87.41474548297856, 41.65421601586942],
          [-87.63447204547856, 42.00622034702279],
          [-87.78828063922856, 42.291305717861384],
          [-87.73334899860356, 42.736701315690176],
          [-87.81025329547856, 42.88982729795633],
          [-87.87617126422856, 43.2589826692013],
          [-87.71122931135113, 43.69299677372106],
          [-87.66728399885113, 44.00200004536326],
          [-87.52446173322613, 44.18348224013727],
          [-87.52446173322613, 44.36440746686124],
          [-87.32670782697613, 44.70116466389233],
          [-87.04106329572613, 45.22973598048657],
          [-87.32670782697613, 44.99714312967495],
          [-87.53544806135113, 44.85713239500583],
          [-87.76616095197613, 44.66210690257903],
          [-88.01884649885113, 44.49777677946881],
          [-87.96391485822613, 44.740196094116946],
          [-87.65629767072613, 44.98937370856488],
          [-87.51347540510113, 45.19877837127016],
          [-87.07402228010113, 45.69975154878014],
          [-86.89824103010113, 45.70742407587662],
          [-86.77739142072613, 45.853002032874535],
          [-86.51371954572613, 45.853002032874535],
          [-86.73344610822613, 45.638333423916805],
          [-86.54667853010113, 45.67672764954249],
          [-86.30497931135113, 45.853002032874535],
          [-86.11821173322613, 45.921827352096734],
          [-85.70073126447613, 45.96002679369306],
          [-85.55790899885113, 46.08208815758358],
          [-85.28325079572613, 46.06684522365722],
          [-84.78886603010113, 45.90654020623198],
          [-84.65703009260113, 45.93711028693857],
          [-84.27250860822613, 45.998199917552185],
          [-83.94291876447613, 45.952389010830345],
          [-83.93193243635113, 46.08208815758358],
          [-84.11870001447613, 46.332988786641835],
          [-84.19560431135113, 46.5147422702551],
          [-84.34941290510113, 46.476926929588316],
          [-84.59111212385113, 46.476926929588316],
          [-85.01957892072613, 46.499619289577524],
          [-85.01957892072613, 46.64311774774221],
          [-85.01957892072613, 46.786236590270335],
          [-85.57988165510113, 46.68081740140345],
          [-86.03032110822613, 46.688354177605206],
          [-86.29399298322613, 46.57519212099311],
          [-86.84330938947613, 46.499619289577524],
          [-87.26078985822613, 46.499619289577524],
          [-87.40361212385113, 46.60539180485999],
          [-87.68925665510113, 46.86140985773487],
          [-88.09575079572613, 46.92147279323749],
          [-88.45829962385113, 46.77871348191293],
          [-88.40336798322613, 47.01144108760569],
          [-88.08476446760113, 47.250616936227395],
          [-87.66728399885113, 47.369801598078304],
          [-87.73320196760113, 47.48871753728608],
          [-88.16166876447613, 47.48129316204783],
          [-88.54619024885113, 47.280438299455746],
          [-88.87578009260113, 47.04888322003977],
          [-89.10649298322613, 47.01144108760569],
          [-89.42509649885113, 46.85389726113413],
          [-89.73271368635113, 46.83135316468301],
          [-89.96342657697613, 46.73355275447184],
          [-90.40287970197613, 46.60539180485999],
          [-90.65556524885113, 46.65820076380171],
          [-90.87529181135113, 46.61293909666906],
          [-90.77641485822613, 46.83135316468301],
          [-90.79838751447613, 46.943979053157875],
          [-91.40263556135113, 46.80127965323971],
          [-91.94096563947613, 46.73355275447184],
          [-92.00688360822613, 46.80127965323971],
          [-91.64433478010113, 46.99645687982744],
          [-91.10600470197613, 47.40699169140336],
          [-90.41386603010113, 47.725743631353076],
          [-89.41411017072613, 48.02051646552974],
          [-89.87553595197613, 48.02051646552974],
          [-90.08427618635113, 48.13062410947617],
          [-90.72148321760113, 48.13062410947617],
          [-90.87529181135113, 48.255127989423634],
          [-91.21586798322613, 48.123290930094534],
          [-91.51249884260113, 48.07192935545963],
          [-91.90800665510113, 48.26975561817212],
          [-92.02885626447613, 48.37203183108152],
          [-92.30351446760113, 48.3428309799743],
          [-92.38041876447613, 48.24781260530134],
          [-92.52324103010113, 48.495948759592835],
          [-92.67704962385113, 48.575969289640796],
          [-93.22636603010113, 48.6703759740463],
          [-93.47905157697613, 48.575969289640796],
          [-93.75370978010113, 48.510507354808695],
          [-93.81962774885113, 48.64134657093784],
          [-94.12724493635113, 48.663120190356196],
          [-94.41288946760113, 48.72838463839406],
          [-94.65458868635113, 48.78632646159059],
          [-94.78642462385113, 49.32628376573581],
          [-95.15995978010113, 49.41928027952168],
          [-95.18193243635113, 49.003013301911054],
          [-98.26909063947613, 49.017425703261786],
          [-102.46586798322613, 49.010220024085406],
          [-106.57475470197613, 49.017425703261786],
          [-110.80449103010113, 49.02463033947713],
          [-113.85869024885113, 49.003013301911054],
          [-116.14384649885113, 49.017425703261786],
          [-118.35209845197613, 49.02463033947713],
          [-121.05473517072613, 49.010220024085406],
          [-122.58183478010113, 49.017425703261786],
          [-122.80156134260113, 48.95253703965156],
          [-122.72465704572613, 48.79356449060701],
          [-122.52690313947613, 48.7428763598589],
          [-122.52690313947613, 48.568699922191044],
          [-122.59282110822613, 48.42309305024562],
          [-122.49394415510113, 48.298998318541514],
          [-122.76860235822613, 48.123290930094534],
          [-123.01030157697613, 48.0866093268904],
          [-123.09819220197613, 48.145287327214824],
          [-123.35087774885113, 48.13062410947617],
          [-123.75737188947613, 48.15261736563079],
          [-124.15287970197613, 48.225860173576905],
          [-124.48246954572613, 48.357433497679345],
          [-124.70219610822613, 48.40850935991556],
          [-124.73515509260113, 48.21854060311511],
          [-124.70219610822613, 47.97640742391953],
          [-124.43852423322613, 47.710960965177605],
          [-124.37260626447613, 47.55548969748724],
          [-124.24077032697613, 47.16105203607767],
          [-124.09794806135113, 46.75613784914383],
          [-124.08696173322613, 46.43908529138622],
          [-123.92216681135113, 46.00583138430023],
          [-123.98808478010113, 45.59991287230622],
          [-124.04301642072613, 44.880491216597214]]])
